# Authentication configuration for PSFX Suite

# Disable plaintext auth without SSL for security (enable for dev)
disable_plaintext_auth = no

# Authentication mechanisms
auth_mechanisms = plain login

# Password database - managed by PSFX Suite backend
# File is generated by backend to /etc/dovecot/users with {BLF-CRYPT} prefix for bcrypt
passdb {
  driver = passwd-file
  args = scheme=BLF-CRYPT username_format=%u /etc/dovecot/users
}

# User database - same file as passdb (passwd-file format includes both)
userdb {
  driver = passwd-file
  args = username_format=%u /etc/dovecot/users
  default_fields = uid=5000 gid=5000 home=/var/mail/vhosts/%d/%n
}

# Service for SASL auth
service auth {
  # For client authentication
  unix_listener auth-userdb {
    mode = 0600
    user = dovecot
  }

  # TCP listener for SASL auth from other containers (e.g., Postfix)
  inet_listener {
    port = 12345
  }
}
